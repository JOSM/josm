name: Java CI Build
env:
  junit_platform_version: '1.7.2'
  # ANT_HOME is also our ant version
  ANT_HOME: 'apache-ant-1.10.11'
on:
  push:
    branches: [master]

defaults:
  run:
    shell: bash

jobs:

  createrelease:
    name: Create Release
    runs-on: ubuntu-latest
    env:
      LANG: en_US.UTF-8
    outputs:
      upload_url: ${{ steps.create_release.outputs.upload_url }}
      josm_revision: ${{ steps.create_revision.outputs.josm_revision }}
      josm_prerelease: ${{ steps.create_revision.outputs.josm_prerelease }}
      josm_release_tag: ${{ steps.create_revision.outputs.josm_release_tag }}
    steps:
      - name: Checkout
        uses: actions/checkout@v2
        with:
          fetch-depth: 256

      - name: Build and package for Windows
        if: ${{ runner.os == 'windows' && matrix.java != '8' && matrix.java != '11' && always() }}
        env:
          SIGN_CERT: ${{ secrets.SIGN_CERT }}
          SIGN_STOREPASS: ${{ secrets.SIGN_STOREPASS }}
          SIGN_TSA: ${{ secrets.SIGN_TSA }}
        run: |
          ls "C:\Program Files (x86)\"
          ls "C:\Program Files (x86)\Microsoft"
          ls "C:\Program Files (x86)\Microsoft SDKs"
          ls "C:\Program Files (x86)\Microsoft Visual Studio"
          ls "C:\Program Files (x86)\Windows Kits"
